<div class="max-w-6xl mx-auto py-6">
    <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #f1f5f9; padding-bottom: 20px; margin-bottom: 30px;">
        <h1 class="text-3xl font-bold text-gray-800">Session Details</h1>
        <button onclick="openModal()" class="bg-[#00d1b2] text-white px-4 py-2 rounded font-bold hover:opacity-90">
            + NEW SESSION
        </button>
    </div>

    <div class="bg-white rounded shadow overflow-hidden border border-gray-200">
        <table class="w-full text-left border-collapse">
            <thead>
                <tr class="bg-gray-100 border-b border-gray-200 text-gray-600 text-xs font-bold uppercase tracking-wider">
                    <th class="p-4">#</th>
                    <th class="p-4">Lesson Focus</th>
                    <th class="p-4">Manner Topic</th>
                    <th class="p-4 text-right">Actions</th>
                </tr>
            </thead>
            <tbody id="sessionTableBody">
                </tbody>
        </table>
    </div>
</div>

<div id="sessionModal" style="display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); overflow-y: auto;">
    <div style="background: white; margin: 5% auto; padding: 30px; border-radius: 8px; width: 90%; max-width: 800px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
        <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
            <h2 id="modalTitle" class="text-2xl font-bold text-gray-800">Manage Session</h2>
            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
        </div>
        
        <form id="sessionForm" class="space-y-4">
            <input type="hidden" id="sessionId">
            
            <div class="grid grid-cols-3 gap-4">
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase">Session Num</label>
                    <input type="number" id="session_num" class="w-full border p-2 rounded mt-1" required>
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase">Theme Color</label>
                    <input type="text" id="theme_color" placeholder="#FF5733" class="w-full border p-2 rounded mt-1">
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase">Map Icon URL</label>
                    <input type="text" id="map_icon_url" class="w-full border p-2 rounded mt-1">
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4 border-t pt-4">
                <div class="bg-gray-50 p-3 rounded border">
                    <label class="block text-xs font-bold text-blue-600 uppercase">Lesson 1</label>
                    <input type="text" id="lesson_1_title" placeholder="Title" class="w-full border p-2 rounded mt-1 mb-2">
                    <select id="lesson_1_cat" class="w-full border p-2 rounded">
                        <option value="Alphabet">Alphabet</option>
                        <option value="Numbers">Numbers</option>
                        <option value="Motor Skills">Motor Skills</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="bg-gray-50 p-3 rounded border">
                    <label class="block text-xs font-bold text-green-600 uppercase">Lesson 2</label>
                    <input type="text" id="lesson_2_title" placeholder="Title" class="w-full border p-2 rounded mt-1 mb-2">
                    <select id="lesson_2_cat" class="w-full border p-2 rounded">
                        <option value="Alphabet">Alphabet</option>
                        <option value="Numbers">Numbers</option>
                        <option value="Motor Skills">Motor Skills</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
            </div>

            <div>
                <label class="block text-xs font-bold text-gray-500 uppercase">Manner Topic</label>
                <input type="text" id="manner_topic" class="w-full border p-2 rounded mt-1">
            </div>

            <div class="grid grid-cols-3 gap-2">
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase">Obj 1</label>
                    <input type="text" id="obj_text_1" class="w-full border p-2 rounded mt-1 text-sm">
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase">Obj 2</label>
                    <input type="text" id="obj_text_2" class="w-full border p-2 rounded mt-1 text-sm">
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase">Obj 3</label>
                    <input type="text" id="obj_text_3" class="w-full border p-2 rounded mt-1 text-sm">
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase">Physical Activity</label>
                    <input type="text" id="physical_activity" class="w-full border p-2 rounded mt-1">
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase">Home Time Activity</label>
                    <input type="text" id="home_time_activity" class="w-full border p-2 rounded mt-1">
                </div>
            </div>

            <div>
                <label class="block text-xs font-bold text-gray-500 uppercase">Full Lesson Plan (Paste)</label>
                <textarea id="full_lesson_plan" rows="4" class="w-full border p-2 rounded mt-1"></textarea>
            </div>

            <div class="flex justify-end gap-3 border-t pt-4">
                <button type="button" onclick="closeModal()" class="bg-gray-200 px-4 py-2 rounded font-bold text-gray-700">Cancel</button>
                <button type="submit" class="bg-blue-600 px-4 py-2 rounded font-bold text-white">Save Session</button>
            </div>
        </form>
    </div>
</div>

<script>
    const API_URL = "https://x8ki-letl-twmt.n7.xano.io/api:joVisOhQ/session_details";

    function openModal() { document.getElementById('sessionModal').style.display = 'block'; }
    function closeModal() { 
        document.getElementById('sessionModal').style.display = 'none'; 
        document.getElementById('sessionForm').reset();
        document.getElementById('sessionId').value = '';
    }

    async function loadSessions() {
        try {
            const res = await fetch(API_URL);
            const data = await res.json();
            const tbody = document.getElementById('sessionTableBody');
            tbody.innerHTML = data.map(s => `
                <tr class="border-b hover:bg-gray-50">
                    <td class="p-4 font-bold">#${s.session_num}</td>
                    <td class="p-4">
                        <div class="font-bold text-blue-800 text-sm">${s.lesson_1_title || ''}</div>
                        <div class="font-bold text-green-800 text-sm">${s.lesson_2_title || ''}</div>
                    </td>
                    <td class="p-4 text-sm italic text-gray-600">${s.manner_topic || ''}</td>
                    <td class="p-4 text-right">
                        <button onclick="editSession(${s.id})" class="text-blue-600 font-bold mr-3 text-xs">EDIT</button>
                        <button onclick="deleteSession(${s.id})" class="text-red-600 font-bold text-xs">DEL</button>
                    </td>
                </tr>
            `).join('');
        } catch (e) { console.error("Load Error:", e); }
    }

    window.editSession = async function(id) {
        const res = await fetch(`${API_URL}/${id}`);
        const s = await res.json();
        document.getElementById('sessionId').value = s.id;
        document.getElementById('session_num').value = s.session_num;
        document.getElementById('lesson_1_title').value = s.lesson_1_title;
        document.getElementById('lesson_1_cat').value = s.lesson_1_cat;
        document.getElementById('lesson_2_title').value = s.lesson_2_title;
        document.getElementById('lesson_2_cat').value = s.lesson_2_cat;
        document.getElementById('manner_topic').value = s.manner_topic;
        document.getElementById('obj_text_1').value = s.obj_text_1;
        document.getElementById('obj_text_2').value = s.obj_text_2;
        document.getElementById('obj_text_3').value = s.obj_text_3;
        document.getElementById('physical_activity').value = s.physical_activity;
        document.getElementById('home_time_activity').value = s.home_time_activity;
        document.getElementById('theme_color').value = s.theme_color;
        document.getElementById('map_icon_url').value = s.map_icon_url;
        document.getElementById('full_lesson_plan').value = s.full_lesson_plan;
        openModal();
    };

    document.getElementById('sessionForm').onsubmit = async (e) => {
        e.preventDefault();
        const id = document.getElementById('sessionId').value;
        const payload = {
            session_num: parseInt(document.getElementById('session_num').value),
            lesson_1_title: document.getElementById('lesson_1_title').value,
            lesson_1_cat: document.getElementById('lesson_1_cat').value,
            lesson_2_title: document.getElementById('lesson_2_title').value,
            lesson_2_cat: document.getElementById('lesson_2_cat').value,
            manner_topic: document.getElementById('manner_topic').value,
            obj_text_1: document.getElementById('obj_text_1').value,
            obj_text_2: document.getElementById('obj_text_2').value,
            obj_text_3: document.getElementById('obj_text_3').value,
            physical_activity: document.getElementById('physical_activity').value,
            home_time_activity: document.getElementById('home_time_activity').value,
            theme_color: document.getElementById('theme_color').value,
            map_icon_url: document.getElementById('map_icon_url').value,
            full_lesson_plan: document.getElementById('full_lesson_plan').value
        };
        await fetch(id ? `${API_URL}/${id}` : API_URL, {
            method: id ? 'PATCH' : 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(payload)
        });
        closeModal();
        loadSessions();
    };

    window.deleteSession = async function(id) {
        if(confirm('Delete?')) {
            await fetch(`${API_URL}/${id}`, {method: 'DELETE'});
            loadSessions();
        }
    };

    loadSessions();
</script>
