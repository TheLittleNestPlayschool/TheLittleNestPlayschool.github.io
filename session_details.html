<style>
    /* Professional Serif Headers to match Admin Roles */
    .nest-header { font-family: 'Georgia', serif; color: #1a365d; }
    
    /* Table Styling matched to Admin Roles Screen */
    .nest-table { width: 100%; border-collapse: collapse; background: white; border: 1px solid #e2e8f0; }
    .nest-table th { background: #f8fafc; padding: 12px; font-size: 0.75rem; color: #475569; text-transform: uppercase; border-bottom: 2px solid #e2e8f0; text-align: left; }
    .nest-table td { padding: 12px; border-bottom: 1px solid #f1f5f9; font-size: 0.85rem; vertical-align: top; color: #333; }

    /* Modal Grid Organization */
    .nest-modal { display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); overflow-y: auto; }
    .nest-modal-content { background: white; margin: 2% auto; padding: 30px; border-radius: 8px; width: 90%; max-width: 1100px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
    
    .form-section { border-bottom: 1px solid #e2e8f0; padding-bottom: 20px; margin-bottom: 20px; }
    .form-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 15px; }
    .lesson-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 10px; }
    
    label { display: block; font-size: 0.7rem; font-weight: bold; color: #64748b; text-transform: uppercase; margin-bottom: 5px; letter-spacing: 0.5px; }
    input, select, textarea { width: 100%; border: 1px solid #cbd5e1; padding: 10px; border-radius: 4px; font-size: 0.9rem; box-sizing: border-box; }

    /* Branding Buttons & Links */
    .btn-teal { background: #00d1b2; color: white; padding: 10px 20px; border-radius: 4px; font-weight: bold; border: none; cursor: pointer; text-transform: uppercase; font-size: 0.8rem; }
    .btn-gray { background: #94a3b8; color: white; padding: 10px 20px; border-radius: 4px; font-weight: bold; border: none; cursor: pointer; text-transform: uppercase; font-size: 0.8rem; }
    .action-edit { color: blue; font-weight: bold; cursor: pointer; text-decoration: none; font-size: 0.8rem; }
    .action-del { color: red; font-weight: bold; cursor: pointer; text-decoration: none; font-size: 0.8rem; }
</style>

<div class="max-w-7xl mx-auto p-6">
    <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 30px;">
        <h1 class="text-5xl nest-header">Session Details</h1>
        <button onclick="openModal()" class="btn-teal">+ New Session</button>
    </div>

    <table class="nest-table">
        <thead>
            <tr>
                <th style="width: 50px;">ID</th>
                <th style="width: 80px;">Sess #</th>
                <th>Academic Focus</th>
                <th>Objectives</th>
                <th>Manner Topic</th>
                <th>Activities</th>
                <th style="text-align: center; width: 100px;">Actions</th>
            </tr>
        </thead>
        <tbody id="sessionTableBody">
            </tbody>
    </table>
</div>

<div id="sessionModal" class="nest-modal">
    <div class="nest-modal-content">
        <h2 id="modalTitle" class="text-4xl nest-header" style="margin-bottom: 25px; border-bottom: 1px solid #eee; padding-bottom: 10px;">Manage Session</h2>
        
        <form id="sessionForm">
            <input type="hidden" id="sessionId">
            
            <div class="form-section">
                <div class="form-grid">
                    <div><label>Session Number</label><input type="number" id="session_num" required></div>
                    <div><label>Theme Color (Hex)</label><input type="text" id="theme_color" placeholder="#FF5733"></div>
                    <div><label>Map Icon URL</label><input type="text" id="map_icon_url"></div>
                </div>
            </div>

            <div class="form-section">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                    <div class="lesson-grid">
                        <div><label>Lesson 1 Title</label><input type="text" id="lesson_1_title"></div>
                        <div><label>Category</label><select id="lesson_1_cat">
                            <option value="Alphabet">Alphabet</option><option value="Numbers">Numbers</option><option value="Motor Skills">Motor Skills</option><option value="Other">Other</option>
                        </select></div>
                    </div>
                    <div class="lesson-grid">
                        <div><label>Lesson 2 Title</label><input type="text" id="lesson_2_title"></div>
                        <div><label>Category</label><select id="lesson_2_cat">
                            <option value="Alphabet">Alphabet</option><option value="Numbers">Numbers</option><option value="Motor Skills">Motor Skills</option><option value="Other">Other</option>
                        </select></div>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <div style="margin-bottom: 15px;"><label>Manner Topic</label><input type="text" id="manner_topic"></div>
                <div class="form-grid">
                    <div><label>Objective 1</label><input type="text" id="obj_text_1"></div>
                    <div><label>Objective 2</label><input type="text" id="obj_text_2"></div>
                    <div><label>Objective 3</label><input type="text" id="obj_text_3"></div>
                </div>
            </div>

            <div class="form-section">
                <div class="form-grid" style="grid-template-columns: 1fr 1fr;">
                    <div><label>Physical Activity</label><input type="text" id="physical_activity"></div>
                    <div><label>Home Time Activity</label><input type="text" id="home_time_activity"></div>
                </div>
            </div>

            <div><label>Full Lesson Plan (Paste)</label><textarea id="full_lesson_plan" rows="5"></textarea></div>

            <div style="display: flex; justify-content: flex-end; gap: 15px; margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px;">
                <button type="button" onclick="closeModal()" class="btn-gray">Cancel</button>
                <button type="submit" class="btn-teal">Save Session Data</button>
            </div>
        </form>
    </div>
</div>

<script>
    const API_URL = "https://x8ki-letl-twmt.n7.xano.io/api:joVisOhQ/session_details";

    function openModal() { document.getElementById('sessionModal').style.display = 'block'; }
    function closeModal() { 
        document.getElementById('sessionModal').style.display = 'none'; 
        document.getElementById('sessionForm').reset();
        document.getElementById('sessionId').value = '';
    }

    async function loadSessions() {
        try {
            const res = await fetch(API_URL);
            const data = await res.json();
            const tbody = document.getElementById('sessionTableBody');
            tbody.innerHTML = data.map(s => `
                <tr>
                    <td style="color: #94a3b8; font-family: monospace;">${s.id}</td>
                    <td style="font-weight: bold; font-size: 1rem;">${s.session_num}</td>
                    <td>
                        <div style="font-weight: bold; color: #1e293b;">${s.lesson_1_title || '---'}</div>
                        <div style="font-size: 0.75rem; color: #64748b;">${s.lesson_2_title || ''}</div>
                    </td>
                    <td style="font-size: 0.75rem; line-height: 1.4;">
                        • ${s.obj_text_1 || '-'}<br>
                        • ${s.obj_text_2 || '-'}<br>
                        • ${s.obj_text_3 || '-'}
                    </td>
                    <td style="font-style: italic; color: #475569;">${s.manner_topic || ''}</td>
                    <td style="font-size: 0.75rem; color: #64748b;">
                        <b>Physical:</b> ${s.physical_activity || '-'}<br>
                        <b>Home:</b> ${s.home_time_activity || '-'}
                    </td>
                    <td style="text-align: center; white-space: nowrap;">
                        <a onclick="editSession(${s.id})" class="action-edit">Edit</a>
                        <span style="color: #cbd5e1; margin: 0 5px;">|</span>
                        <a onclick="deleteSession(${s.id})" class="action-del">Del</a>
                    </td>
                </tr>
            `).join('');
        } catch (e) { console.error("Data Load Error", e); }
    }

    window.editSession = async function(id) {
        const res = await fetch(`${API_URL}/${id}`);
        const s = await res.json();
        
        document.getElementById('sessionId').value = s.id;
        document.getElementById('session_num').value = s.session_num;
        document.getElementById('lesson_1_title').value = s.lesson_1_title;
        document.getElementById('lesson_1_cat').value = s.lesson_1_cat;
        document.getElementById('lesson_2_title').value = s.lesson_2_title;
        document.getElementById('lesson_2_cat').value = s.lesson_2_cat;
        document.getElementById('manner_topic').value = s.manner_topic;
        document.getElementById('obj_text_1').value = s.obj_text_1;
        document.getElementById('obj_text_2').value = s.obj_text_2;
        document.getElementById('obj_text_3').value = s.obj_text_3;
        document.getElementById('physical_activity').value = s.physical_activity;
        document.getElementById('home_time_activity').value = s.home_time_activity;
        document.getElementById('theme_color').value = s.theme_color;
        document.getElementById('map_icon_url').value = s.map_icon_url;
        document.getElementById('full_lesson_plan').value = s.full_lesson_plan;
        
        document.getElementById('modalTitle').innerText = "Edit Session Details";
        openModal();
    }

    document.getElementById('sessionForm').onsubmit = async (e) => {
        e.preventDefault();
        const id = document.getElementById('sessionId').value;
        const payload = {
            session_num: parseInt(document.getElementById('session_num').value),
            lesson_1_title: document.getElementById('lesson_1_title').value,
            lesson_1_cat: document.getElementById('lesson_1_cat').value,
            lesson_2_title: document.getElementById('lesson_2_title').value,
            lesson_2_cat: document.getElementById('lesson_2_cat').value,
            manner_topic: document.getElementById('manner_topic').value,
            obj_text_1: document.getElementById('obj_text_1').value,
            obj_text_2: document.getElementById('obj_text_2').value,
            obj_text_3: document.getElementById('obj_text_3').value,
            physical_activity: document.getElementById('physical_activity').value,
            home_time_activity: document.getElementById('home_time_activity').value,
            theme_color: document.getElementById('theme_color').value,
            map_icon_url: document.getElementById('map_icon_url').value,
            full_lesson_plan: document.getElementById('full_lesson_plan').value
        };

        await fetch(id ? `${API_URL}/${id}` : API_URL, {
            method: id ? 'PATCH' : 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(payload)
        });
        closeModal();
        loadSessions();
    };

    window.deleteSession = async function(id) {
        if(confirm('Delete this curriculum session?')) {
            await fetch(`${API_URL}/${id}`, {method: 'DELETE'});
            loadSessions();
        }
    };

    loadSessions();
</script>
